<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>部署 gotosocial</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://bobobo80.com/2023/bu-shu-gotosocial.html" rel="canonical" />
  <!-- Feed -->
  <link href="https://bobobo80.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
    title="On the wing 展翼 Full Atom Feed" />
  <link href="https://bobobo80.com/feeds/tech.atom.xml" type="application/atom+xml"
    rel="alternate" title="On the wing 展翼 Categories Atom Feed" />

  <link href="https://bobobo80.com/theme/css/style.css" type="text/css" rel="stylesheet" />


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    var siteUrl = 'https://bobobo80.com';
  </script>

  <script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>







    <meta name="description" content="自马斯克收购 twitter 后幺蛾子不断，最近更是封杀了第三方客户端，这下我常用的 tweetbot 也不能用了。所以有些人已经开始转向其 …">

    <meta name="author" content="bobobo80">

    <meta name="tags" content="docker">
    <meta name="tags" content="gotosocial">
    <meta name="tags" content="mastodon">
    <meta name="tags" content="twitter">
    <meta name="tags" content="portainer">




<!-- Open Graph -->
<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="On the wing 展翼"/>
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="部署 gotosocial"/>
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="自马斯克收购 twitter 后幺蛾子不断，最近更是封杀了第三方客户端，这下我常用的 tweetbot 也不能用了。所以有些人已经开始转向其 …"/>
<meta prefix="og: http://ogp.me/ns#" property="og:locale" content="en_US"/>
<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://bobobo80.com/2023/bu-shu-gotosocial.html"/>
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"/>
<meta prefix="og: http://ogp.me/ns#" property="article:published_time" content="2023-02-19 00:00:00+08:00"/>
<meta prefix="og: http://ogp.me/ns#" property="article:modified_time" content=""/>
<meta prefix="og: http://ogp.me/ns#" property="article:author" content="https://bobobo80.com/author/bobobo80.html">
<meta prefix="og: http://ogp.me/ns#" property="article:section" content="Tech"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="docker"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="gotosocial"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="mastodon"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="twitter"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="portainer"/>
<meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://bobobo80.com/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "部署 gotosocial",
  "headline": "部署 gotosocial",
  "datePublished": "2023-02-19 00:00:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Bobobo80",
    "url": "https://bobobo80.com/author/bobobo80.html"
  },
  "image": "https://bobobo80.com/theme/images/post-bg.jpg",
  "url": "https://bobobo80.com/2023/bu-shu-gotosocial.html",
  "description": "自马斯克收购 twitter 后幺蛾子不断，最近更是封杀了第三方客户端，这下我常用的 tweetbot 也不能用了。所以有些人已经开始转向其 …"
}
</script>
</head>







<body class="category-template">

<div class="nav-header">
  <nav class="nav-wrapper" aria-label="Main">
<ul>


</ul>
<ul class="nav-meta">
    <li class="nav-github"><a aria-label="Github" href="https://github.com/bobobo80" target="_blank"><i class="icon icon-github" aria-hidden="true"></i>
    <span>github</span>
    </a></li>
  <li class="nav-search" style="display: none;">
    <a title="Search">
      <i class="icon icon-search" aria-hidden="true"></i>
      <span>Search</span>
    </a>
  </li>
</ul>  </nav>

  <div class="nav-wrapper-control">
    <div class="inner">
      <a class="nav-menu" role="button"><i class="icon icon-menu" aria-hidden="true"></i>Menu</a>
      <a class="nav-search" title="Search" role="button" style="display: none;"><i class="icon icon-search" aria-hidden="true"></i></a>
    </div>
  </div>
</div>
<div class="nav-close" role="button" aria-label="Close"></div>
  <section id="wrapper" class="page-wrapper">
    <!-- Progressbar -->
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="post-header ">
      <div class="inner">
        <span class="post-info">
          <span class="post-type">Article</span>
          <span class="post-count">Tech</span>
        </span>
        <h1 class="post-title">部署 gotosocial</h1>
        <div class="post-meta">
          <div class="post-meta-avatars">


            <figure class="post-meta-avatar avatar">
              <a class="author-avatar" href="https://bobobo80.com/author/bobobo80.html">
                <img class="author-profile-image" src="https://bobobo80.com/images/avatar.png" alt="bobobo80" />
              </a>
            </figure>
          </div>

          <h4 class="post-meta-author">
            bobobo80
          </h4>
          <time datetime="Sun 19 February 2023">Sun 19 February 2023</time>
        </div>
      </div>
    </header>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
          <section class="post-content">
            <p>自马斯克收购 twitter 后幺蛾子不断，最近更是封杀了第三方客户端，这下我常用的 tweetbot 也不能用了。所以有些人已经开始转向其他平台了，其中以 mastodon 和 nostr 最为流行，我大概了解了一下两个平台，感觉 mastodon 的方式相对更为合理，所以也开始试用了一下。当然 nostr 的 damus 客户端我也下载试用了。</p>
<p><a href="https://joinmastodon.org/">mastodon</a> 只是基于 activitypub 协议的一种最为流行的实现。目前社区应该还挺活跃的，中文用户有很多。不过 mastodon 是使用 ruby 开发的，而且算是面向人数较多的一个大平台，我又想自己部署，所以又找了消耗资源相对较少的其他实现，这其中 <a href="https://github.com/superseriousbusiness/gotosocial">gotosocial</a> 算是以此目的一种实现。我这里就只简单记录一下我自己是如何部署 gotosocial 的。</p>
<p>我之前已经有一套基于 <a href="https://bobobo80.com/2021/ge-ren-fu-wu-qi-zi-dong-hua-bu-shu.html">docker swarn 的环境</a>，在此基础上新开一个 gotosocial 是非常简单快速的。官方文档给出了如何使用 docker 部署，我参考了 docker compose 的 yaml 文件创建了自己的 stacks 配置完成的部署。</p>
<ul>
<li>先建好 volume，因为 gotosocial 使用 sqlite，还要存很多图片所以会占用比较大的空间，可以设置单独一个新的硬盘，如果你和我一样是使用低配 vps 的话，因为我的 vps 只有 10GB，加上系统和其他服务，剩余的空间不多了，所以我又单独加了一块硬盘空间给 gotosocial 使用。</li>
<li>新建 stacks，我是参考了官方的 yaml。network 是使用了已有的 nginx 网络，因为会由 nginx 转给相当于在 docker 内网的 gotosocial，所以 gotosocial 也不配置 https 证书，不设置 port。volume 使用上一步创建的 vol。剩下的就是 host 和 db type 和 db path 了，使用默认的就好。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.3&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gotosocial</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">superseriousbusiness/gotosocial:latest</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-net</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">GTS_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mb.bobobo80.com</span>
<span class="w">      </span><span class="nt">GTS_DB_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">      </span><span class="nt">GTS_DB_ADDRESS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/gotosocial/storage/sqlite.db</span>
<span class="w">      </span><span class="nt">GTS_LETSENCRYPT_ENABLED</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
<span class="w">      </span><span class="nt">GTS_LETSENCRYPT_EMAIL_ADDRESS</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">      </span><span class="c1">## For reverse proxy setups:</span>
<span class="w">      </span><span class="c1"># GTS_TRUSTED_PROXIES: &quot;172.x.x.x&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gotosocial_data:/gotosocial/storage</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;always&quot;</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gotosocial_data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">nginx-net</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>

<ul>
<li>stack 建好后，启动服务，gotosocial 就在 docker 内网里启动起来了。之后就是 nginx 的设置了，使用已有的 <a href="https://nginxproxymanager.com/">nginx proxy manager</a>，把 mb.bobobo80.com 转发给 gotosocial 的 8080 端口（是 gotosocial 的默认端口），开启强制 https 并自动续期签名，就可以和外网连接起来了。</li>
<li>gotosocial 的第一个用户是需要用命令行创建的，所以还要按照官网的命令创建第一个用户。</li>
</ul>
<p>至此，整个 gotosocial 就算是搭建好了。因为 gotosocial 没有提供前端页面（实际是有几个页面的，但是不能发推），所以要使用其他客户登录，然后才能使用。我用网页版 pinafore 和 mastodon ios 客户端都可是正常使用。</p>
<p>最后，再说 2 个需要注意的地方。服务内存占用不大，我现在还没怎么使用内存占用应该再 20-50MB，不过硬盘占用会相对大一点，所以主要硬盘空间。第二点，目前 gotosocial 还没有开发迁移功能，现在还不能迁出，所以如果开始自己的服务时还是想好域名，因为一旦开始写内容了，发现域名不合适就改不了了。</p>
<p>欢迎关注我的 activitypub 账号@me@mb.bobobo80.com</p>
          </section>


          <section class="post-footer" >
            <div class="post-share">
              <span class="post-info-label">Share</span>
              <a title="Twitter" aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=部署 gotosocial&amp;url=https://bobobo80.com/2023/bu-shu-gotosocial.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="icon icon-twitter" aria-hidden="true"></i><span class="hidden">Twitter</span>
              </a>
              <a title="Facebook" aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://bobobo80.com/2023/bu-shu-gotosocial.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="icon icon-facebook" aria-hidden="true"></i><span class="hidden">Facebook</span>
              </a>
              <a title="LinkedIn" aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://bobobo80.com/2023/bu-shu-gotosocial.html&amp;title=部署 gotosocial" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;">
                <i class="icon icon-linkedin" aria-hidden="true"></i><span class="hidden">LinkedIn</span>
              </a>
              <a title="Email" aria-label="Email" class="email" href="mailto:?subject=部署 gotosocial&amp;body=https://bobobo80.com/2023/bu-shu-gotosocial.html">
                <i class="icon icon-mail" aria-hidden="true"></i><span class="hidden">Email</span>
              </a>
              <div class="clear"></div>
            </div>

            <aside class="post-tags">
<a href="https://bobobo80.com/tag/docker.html">docker</a><a href="https://bobobo80.com/tag/gotosocial.html">gotosocial</a><a href="https://bobobo80.com/tag/mastodon.html">mastodon</a><a href="https://bobobo80.com/tag/twitter.html">twitter</a><a href="https://bobobo80.com/tag/portainer.html">portainer</a>            </aside>

            <div class="clear"></div>


          </section>


          <div id="sssc-iframe-container"
            data-host="https://comment.bobobo80.com"
            data-slug="/2023/bu-shu-gotosocial.html"
            data-url="https://bobobo80.com/2023/bu-shu-gotosocial.html"
            data-title="部署 gotosocial">
          </div>
          <script async src="https://comment.bobobo80.com/dist/js/sssc.js"></script>

          <aside class="post-nav">
            <div class="clear"></div>
          </aside>

        </div>
      </article>
    </main>
    <div class="nav-footer">
      <nav class="nav-wrapper" aria-label="Footer">
        <span class="nav-copy">On the wing 展翼 &copy; 2023
        </span>
        <span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> &bull; Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> &bull;
          <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme">
            <span class="theme-icon"></span><span class="theme-text">System theme</span>
          </a>
        </span>
      </nav>
    </div>

  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://bobobo80.com/theme/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="https://bobobo80.com/theme/js/script.js"></script>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVEBH5JMJB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NVEBH5JMJB', { 'anonymize_ip': true });
    </script>

  <!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->

<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre";
    var rstSelector=".highlight pre";
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>

</html>