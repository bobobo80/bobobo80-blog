<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>修饰器及flask的route修饰器</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html" rel="canonical" />
  <!-- Feed -->
  <link href="https://bobobo80.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
    title="On the wing 展翼 Full Atom Feed" />
  <link href="https://bobobo80.com/feeds/tech.atom.xml" type="application/atom+xml"
    rel="alternate" title="On the wing 展翼 Categories Atom Feed" />

  <link href="https://bobobo80.com/theme/css/style.css" type="text/css" rel="stylesheet" />


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script>
    var siteUrl = 'https://bobobo80.com';
  </script>

  <script>
    var localTheme = localStorage.getItem('attila_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>







    <meta name="description" content="python的修饰器是python的一个特色，也是比较难理解的地方，不过运用得当的话会非常优雅和简洁。 通常的两种修饰器形式是无参数的双层结构，即 def decorator(f …">

    <meta name="author" content="bobobo80">

    <meta name="tags" content="flask">




<!-- Open Graph -->
<meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="On the wing 展翼"/>
<meta prefix="og: http://ogp.me/ns#" property="og:title" content="修饰器及flask的route修饰器"/>
<meta prefix="og: http://ogp.me/ns#" property="og:description" content="python的修饰器是python的一个特色，也是比较难理解的地方，不过运用得当的话会非常优雅和简洁。 通常的两种修饰器形式是无参数的双层结构，即 def decorator(f …"/>
<meta prefix="og: http://ogp.me/ns#" property="og:locale" content="en_US"/>
<meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html"/>
<meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"/>
<meta prefix="og: http://ogp.me/ns#" property="article:published_time" content="2017-04-30 00:00:00+08:00"/>
<meta prefix="og: http://ogp.me/ns#" property="article:modified_time" content=""/>
<meta prefix="og: http://ogp.me/ns#" property="article:author" content="https://bobobo80.com/author/bobobo80.html">
<meta prefix="og: http://ogp.me/ns#" property="article:section" content="Tech"/>
<meta prefix="og: http://ogp.me/ns#" property="article:tag" content="flask"/>
<meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://bobobo80.com/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "修饰器及flask的route修饰器",
  "headline": "修饰器及flask的route修饰器",
  "datePublished": "2017-04-30 00:00:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Bobobo80",
    "url": "https://bobobo80.com/author/bobobo80.html"
  },
  "image": "https://bobobo80.com/theme/images/post-bg.jpg",
  "url": "https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html",
  "description": "python的修饰器是python的一个特色，也是比较难理解的地方，不过运用得当的话会非常优雅和简洁。 通常的两种修饰器形式是无参数的双层结构，即 def decorator(f …"
}
</script>
</head>







<body class="category-template">

<div class="nav-header">
  <nav class="nav-wrapper" aria-label="Main">
<ul>


</ul>
<ul class="nav-meta">
    <li class="nav-github"><a aria-label="Github" href="https://github.com/bobobo80" target="_blank"><i class="icon icon-github" aria-hidden="true"></i>
    <span>github</span>
    </a></li>
  <li class="nav-search" style="display: none;">
    <a title="Search">
      <i class="icon icon-search" aria-hidden="true"></i>
      <span>Search</span>
    </a>
  </li>
</ul>  </nav>

  <div class="nav-wrapper-control">
    <div class="inner">
      <a class="nav-menu" role="button"><i class="icon icon-menu" aria-hidden="true"></i>Menu</a>
      <a class="nav-search" title="Search" role="button" style="display: none;"><i class="icon icon-search" aria-hidden="true"></i></a>
    </div>
  </div>
</div>
<div class="nav-close" role="button" aria-label="Close"></div>
  <section id="wrapper" class="page-wrapper">
    <!-- Progressbar -->
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="post-header ">
      <div class="inner">
        <span class="post-info">
          <span class="post-type">Article</span>
          <span class="post-count">Tech</span>
        </span>
        <h1 class="post-title">修饰器及flask的route修饰器</h1>
        <div class="post-meta">
          <div class="post-meta-avatars">


            <figure class="post-meta-avatar avatar">
              <a class="author-avatar" href="https://bobobo80.com/author/bobobo80.html">
                <img class="author-profile-image" src="https://bobobo80.com/images/avatar.png" alt="bobobo80" />
              </a>
            </figure>
          </div>

          <h4 class="post-meta-author">
            bobobo80
          </h4>
          <time datetime="Sun 30 April 2017">Sun 30 April 2017</time>
        </div>
      </div>
    </header>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
          <section class="post-content">
            <p>python的修饰器是python的一个特色，也是比较难理解的地方，不过运用得当的话会非常优雅和简洁。
通常的两种修饰器形式是无参数的双层结构，即</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># do some thing before f</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>

<p>这样，即定义了一个无参的修饰器，使用时在对应函数的前面加上@decorator即可。</p>
<div class="highlight"><pre><span></span><code><span class="nd">@decorator</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c1"># do some thing</span>
    <span class="k">return</span>
</code></pre></div>

<p>相当于</p>
<div class="highlight"><pre><span></span><code><span class="n">foo</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></div>

<p>相当于</p>
<div class="highlight"><pre><span></span><code><span class="n">foo</span> <span class="o">=</span> <span class="n">wrapper</span>
</code></pre></div>

<p>这样，当调用foo时，会先运行wrapper中的代码，在进入foo的执行代码。
因为decorator返回的是wrapper函数引用，所以只在foo被调用时，wrapper中的代码采用运行。</p>
<p>而对于需要带额外参数的修饰器，一般是采用三层结构。</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
    <span class="c1"># do some thing </span>
    <span class="k">def</span> <span class="nf">decorator_func</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># do some thin before f</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator_func</span>
</code></pre></div>

<p>在以函数为参数的外层，再加了一层带其他参数的函数定义。
使用时在对应的函数定义前</p>
<div class="highlight"><pre><span></span><code><span class="nd">@decorator</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c1"># do some thing</span>
    <span class="k">return</span>
</code></pre></div>

<p>这样相当于</p>
<div class="highlight"><pre><span></span><code><span class="n">foo</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">arg</span><span class="p">)(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></div>

<p>相当于</p>
<div class="highlight"><pre><span></span><code><span class="n">foo</span> <span class="o">=</span> <span class="n">decorator_func</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></div>

<p>相当于</p>
<div class="highlight"><pre><span></span><code><span class="n">foo</span> <span class="o">=</span> <span class="n">wrapper</span>
</code></pre></div>

<p>其中decorator的参数可以用于内嵌的deocrator_func和wrapper中
这里需要注意一下各个区间段的运行时间，里层的wrapper中的代码在foo在程序运行时被调用时的之前被运行。而decorator中如果有加入逻辑代码的话，那么将在python解释器读取到函数定义时就被运行。
而flask中的route修饰器就采用了这个用法。
来看一下route的定义，去掉注释。</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>

<p>route是带参修饰器，应该是三层结构，不过由于无需wrapper中进行相关操作，所以可以这么定义，相当于wrapper什么也没有。
也就是相当于</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;endpoint&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div>

<p>来看看route的使用</p>
<div class="highlight"><pre><span></span><code><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="c1"># do some thing</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</code></pre></div>

<p>这样在解释器初始运行时，读到index和route修饰器时，会运行对应decorator中的代码，即运行add_url_rule()方法，即把路由规则加入到app的map中。而index只会在客户端请求后，路由被匹配后被调用。
所以flask就这样优雅的实现了地址路由的设置。
route修饰器的主要目的是为在在初始运行时就运行相应的add_url_rule()等内容，所以，如果当使用多个文件来设置flask应用时，需要注意包含route的view部分py文件，处于在刚开始被引用或导入，这样才能被解释器运行。以狗书的blueprint结构为例，在app所在包的__init__.py中,定义create_app()方法，其中注册每个blueprint模块，这里会导入各个模块包，所以在每个模块包的__init__.py中，需要引用该模块的view</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
</code></pre></div>

<p>这样，就能在create_app()的导入包时，初始化路由设定了。</p>
<p>参考资料
<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014318435599930270c0381a3b44db991cd6d858064ac0000">廖雪峰python教程-修饰器</a></p>
          </section>


          <section class="post-footer" >
            <div class="post-share">
              <span class="post-info-label">Share</span>
              <a title="Twitter" aria-label="Twitter" class="twitter" href="https://twitter.com/share?text=修饰器及flask的route修饰器&amp;url=https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="icon icon-twitter" aria-hidden="true"></i><span class="hidden">Twitter</span>
              </a>
              <a title="Facebook" aria-label="Facebook" class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="icon icon-facebook" aria-hidden="true"></i><span class="hidden">Facebook</span>
              </a>
              <a title="LinkedIn" aria-label="LinkedIn" class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html&amp;title=修饰器及flask的route修饰器" onclick="window.open(this.href, 'linkedin-share', 'width=930,height=720');return false;">
                <i class="icon icon-linkedin" aria-hidden="true"></i><span class="hidden">LinkedIn</span>
              </a>
              <a title="Email" aria-label="Email" class="email" href="mailto:?subject=修饰器及flask的route修饰器&amp;body=https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html">
                <i class="icon icon-mail" aria-hidden="true"></i><span class="hidden">Email</span>
              </a>
              <div class="clear"></div>
            </div>

            <aside class="post-tags">
<a href="https://bobobo80.com/tag/flask.html">flask</a>            </aside>

            <div class="clear"></div>


          </section>


          <div id="sssc-iframe-container"
            data-host="https://comment.bobobo80.com"
            data-slug="/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html"
            data-url="https://bobobo80.com/2017/xiu-shi-qi-ji-flaskde-routexiu-shi-qi.html"
            data-title="修饰器及flask的route修饰器">
          </div>
          <script async src="https://comment.bobobo80.com/dist/js/sssc.js"></script>

          <aside class="post-nav">
            <div class="clear"></div>
          </aside>

        </div>
      </article>
    </main>
    <div class="nav-footer">
      <nav class="nav-wrapper" aria-label="Footer">
        <span class="nav-copy">On the wing 展翼 &copy; 2023
        </span>
        <span class="nav-credits">



          Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a> &bull; Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a> &bull;
          <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme">
            <span class="theme-icon"></span><span class="theme-text">System theme</span>
          </a>
        </span>
      </nav>
    </div>

  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script type="text/javascript" src="https://bobobo80.com/theme/js/jquery.fitvids.js"></script>
  <script type="text/javascript" src="https://bobobo80.com/theme/js/script.js"></script>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NVEBH5JMJB"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NVEBH5JMJB', { 'anonymize_ip': true });
    </script>

  <!-- 	The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in article.html, but it needs to be included down here, after jQuery has already loaded. -->

<script>
  $(document).ready(function () {
    var viewport = $(window);
    var post = $('.post-content');
    // Responsive videos with fitVids
    post.fitVids();

    var mdSelector=".highlight pre";
    var rstSelector=".highlight pre";
    var selector=mdSelector;
    // Format code blocks and add line numbers
    function codestyling() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
        // No lines for plain text blocks
        if (!$(this).hasClass('language-text')) {
          var code = $(this);
          // Calculate amount of lines
          var lines = code.html().split(/\n(?!$)/g).length;
          var numbers = [];
          if (lines > 1) {
            lines++;
          }
          for (i = 1; i < lines; i++) {
            numbers += '<span class="line" aria-hidden="true">' + i + '</span>';
          }
          code.parent().append('<div class="lines">' + numbers + '</div>');
        }
      });
    }

    // Format code blocks only
    function codestylingWithoutLineNumbers() {
      $(selector).each(function(i, e) {
        // Code highlight
        hljs.highlightElement(e);
      });
    }

    codestylingWithoutLineNumbers();
    // Reading progress bar on window top
    function readingProgress() {
      var postBottom = post.offset().top + post.height();
      var viewportHeight = viewport.height();
      var progress = 100 - (((postBottom - (viewport.scrollTop() + viewportHeight) + viewportHeight / 3) / (postBottom - viewportHeight + viewportHeight / 3)) * 100);
      $('.progress-bar').css('width', progress + '%');
      (progress > 100) ? $('.progress-container').addClass('complete'): $('.progress-container').removeClass('complete');
    }
    readingProgress();
    // Trigger reading progress
    viewport.on({
      'scroll': function() {
        readingProgress();
      },
      'resize': function() {
        readingProgress();
      },
      'orientationchange': function() {
        readingProgress();
      }
    });

  });
</script>
</body>

</html>